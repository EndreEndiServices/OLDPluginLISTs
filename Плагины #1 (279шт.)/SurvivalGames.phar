<?php echo "PocketMine-MP plugin Finecraft_SG v0.5\nThis file has been generated using DevTools v1.10.0 at Sat, 30 May 2015 17:33:58 +0200\n----------------\n";if(extension_loaded("phar")){$phar = new \Phar(__FILE__);foreach($phar->getMetadata() as $key => $value){echo ucfirst($key).": ".(is_array($value) ? implode(", ", $value):$value)."\n";}} __HALT_COMPILER(); ?>
ò               a:9:{s:4:"name";s:12:"Finecraft_SG";s:7:"version";s:3:"0.5";s:4:"main";s:20:"Asidert\Finecraft_SG";s:3:"api";a:1:{i:0;s:5:"1.0.0";}s:6:"depend";a:0:{}s:11:"description";N;s:7:"authors";a:1:{i:0;s:7:"Asidert";}s:7:"website";N;s:12:"creationDate";i:1433000038;}	   README.md„   fÿiU„   áµê*∂         src/Asidert/Finecraft_SG.phpz  fÿiUz  y9!∂      
   plugin.yml/  fÿiU/  t'ì∂      =======================================================
THIS PLUGIN MADE BY ASIDERT (ZYRANOV BORIS) FROM RUSSIA
DO NOT COPY CODE!
MY VK: http://www.vk.com/ZyranovBoris
=======================================================<?php
namespace Asidert;

use pocketmine\plugin\PluginBase;
use pocketmine\event\Listener;
use pocketmine\command\Command;
use pocketmine\command\CommandSender;
use pocketmine\level\Position;
use pocketmine\level\Level;
use pocketmine\item\Item;
use pocketmine\Player;
use pocketmine\Server;
use pocketmine\OfflinePlayer;
use pocketmine\utils\Config;
use pocketmine\command\ConsoleCommandSender;
use pocketmine\math\Vector3;
use pocketmine\scheduler\PluginTask;
use pocketmine\scheduler\CallbackTask;
use pocketmine\block\Block;
use pocketmine\event\entity\EntityDeathEvent;
use pocketmine\event\entity\EntityDamageEvent;
use pocketmine\event\player\PlayerInteractEvent;
use pocketmine\tile\Sign;
use pocketmine\tile\Tile;
use pocketmine\utils\TextFormat;
use pocketmine\event\player\PlayerDeathEvent;
use pocketmine\event\player\PlayerQuitEvent;
use onebone\economyapi\EconomyAPI;
use pocketmine\event\block\BlockBreakEvent;
use pocketmine\event\entity\EntityDamageByEntityEvent;
use pocketmine\event\block\BlockPlaceEvent;
use pocketmine\event\player\PlayerCommandPreprocessEvent;
use Asidert\FineChests as FineChests;
use pocketmine\event\player\PlayerRespawnEvent;
use pocketmine\event\player\PlayerMoveEvent;

class Finecraft_SG extends PluginBase implements Listener
{
	private static $obj = null;
	public static function getInstance()
	{
		return self::$obj;
	}
	public function onEnable()
	{
		if(!self::$obj instanceof Main)
		{
			self::$obj = $this;
		}
		$this->getServer()->getPluginManager()->registerEvents($this,$this);
		$this->getServer()->getScheduler()->scheduleRepeatingTask(new CallbackTask([$this,"gameTimber"]),20);
		@mkdir($this->getDataFolder(), 0777, true);
		$this->config=new Config($this->getDataFolder() . "config.yml", Config::YAML, array());
		if($this->config->exists("lastpos"))
		{
			$this->sign=$this->config->get("sign");
			$this->pos1=$this->config->get("pos1");
			$this->pos2=$this->config->get("pos2");
			$this->pos3=$this->config->get("pos3");
			$this->pos4=$this->config->get("pos4");
			$this->pos5=$this->config->get("pos5");
			$this->pos6=$this->config->get("pos6");
			$this->pos7=$this->config->get("pos7");
			$this->pos8=$this->config->get("pos8");
			$this->lastpos=$this->config->get("lastpos");
			$this->level=$this->getServer()->getLevelByName($this->config->get("pos1")["level"]);
			$this->signlevel=$this->getServer()->getLevelByName($this->config->get("sign")["level"]);
			$this->sign=new Vector3($this->sign["x"],$this->sign["y"],$this->sign["z"]);
			$this->pos1=new Vector3($this->pos1["x"]+0.5,$this->pos1["y"]-1,$this->pos1["z"]+0.5);
			$this->pos2=new Vector3($this->pos2["x"]+0.5,$this->pos2["y"]-1,$this->pos2["z"]+0.5);
			$this->pos3=new Vector3($this->pos3["x"]+0.5,$this->pos3["y"]-1,$this->pos3["z"]+0.5);
			$this->pos4=new Vector3($this->pos4["x"]+0.5,$this->pos4["y"]-1,$this->pos4["z"]+0.5);
			$this->pos5=new Vector3($this->pos5["x"]+0.5,$this->pos5["y"]-1,$this->pos5["z"]+0.5);
			$this->pos6=new Vector3($this->pos6["x"]+0.5,$this->pos6["y"]-1,$this->pos6["z"]+0.5);
			$this->pos7=new Vector3($this->pos7["x"]+0.5,$this->pos7["y"]-1,$this->pos7["z"]+0.5);
			$this->pos8=new Vector3($this->pos8["x"]+0.5,$this->pos8["y"]-1,$this->pos8["z"]+0.5);
			$this->lastpos=new Vector3($this->lastpos["x"]+0.5,$this->lastpos["y"]+1,$this->lastpos["z"]+0.5);
		}
		if(!$this->config->exists("endTime"))
		{
			$this->config->set("endTime",180);
		}
		if(!$this->config->exists("gameTime"))
		{
			$this->config->set("gameTime",300);
		}
		if(!$this->config->exists("waitTime"))
		{
			$this->config->set("waitTime",180);
		}
		if(!$this->config->exists("godTime"))
		{
			$this->config->set("godTime",15);
		}
		$this->endTime=(int)$this->config->get("endTime");
		$this->gameTime=(int)$this->config->get("gameTime");
		$this->waitTime=(int)$this->config->get("waitTime");
		$this->godTime=(int)$this->config->get("godTime");
		$this->gameStatus=0;
		$this->lastTime=0;
		$this->players=array();
		$this->SetStatus=array();
		$this->all=0;
		$this->config->save();
		$this->getServer()->getLogger()->info(TextFormat::GREEN."[Finecraft_SG] –ó–∞–≥—Ä—É–∂–µ–Ω–æ !");
	}
	
	public function onCommand(CommandSender $sender, Command $command, $label, array $args)
	{
		if($command->getName()=="lobby")
		{
			if($this->gameStatus>=2)
			{
				$sender->sendMessage("[SG] –ò–≥—Ä–∞ —É–∂–µ –Ω–∞—á–∞–ª–∞—Å—å –≤—ã –Ω–µ –º–æ–∂–µ—Ç–µ –≤–µ—Ä–Ω—É—Ç—å—Å—è –≤ –ª–æ–±–±–∏");
				return;
			}
			if(isset($this->players[$sender->getName()]))
			{	
				unset($this->players[$sender->getName()]);
				$sender->setLevel($this->signlevel);
				$sender->teleport($this->signlevel->getSpawnLocation());
				$sender->sendMessage("[SG] –í–æ–∑–≤—Ä–∞—â–µ–Ω–∏–µ –≤ –õ–æ–±–±–∏...");
				$this->sendToAll("[SG] ".$sender->getName()." –ø–æ–∫–∏–Ω—É–ª –∞—Ä–µ–Ω—É.");
				$this->changeStatusSign();
				if($this->gameStatus==1 && count($this->players)<2)
				{
					$this->gameStatus=0;
					$this->lastTime=0;
					$this->sendToAll("[SG] –ù–∞ –∞—Ä–µ–Ω–µ –º–µ–Ω—å—à–µ 2-—É—Ö –∏–≥—Ä–æ–∫–æ–≤, –æ—Ç—Å—á–µ—Ç –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω");
					/*foreach($this->players as $pl)
					{
						$p=$this->getServer()->getPlayer($pl["id"]);
						$p->setLevel($this->signlevel);
						$p->teleport($this->signlevel->getSpawnLocation());
						unset($p,$pl);
					}*/
				}
			}
			else
			{
				$sender->sendMessage("[SG] –¢—ã –Ω–µ –≤ –∏–≥—Ä–µ !");
			}
			return true;
		}
		if(!isset($args[0])){unset($sender,$cmd,$label,$args);return false;};
		switch ($args[0])
		{
		case "set":
			if($this->config->exists("lastpos"))
			{
				$sender->sendMessage("[SG] –£–∂–µ –≤—Å–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ, —É–¥–∞–ª–∏ –∫–æ–Ω—Ñ–∏–≥");
			}
			else
			{
				$name=$sender->getName();
				$this->SetStatus[$name]=0;
				$sender->sendMessage("[SG] –¢—ã–∫–Ω–∏ —Ç–∞–±–ª—É");
			}
			break;
		case "remove":
			$this->config->remove("sign");
			$this->config->remove("pos1");
			$this->config->remove("pos2");
			$this->config->remove("pos3");
			$this->config->remove("pos4");
			$this->config->remove("pos5");
			$this->config->remove("pos6");
			$this->config->remove("pos7");
			$this->config->remove("pos8");
			$this->config->remove("lastpos");
			$this->config->save();
			unset($this->sign,$this->pos1,$this->pos2,$this->pos3,$this->pos4,$this->pos5,$this->pos6,$this->pos7,$this->pos8,$this->lastpos);
			$sender->sendMessage("[SG] –í—Å–µ —É–¥–∞–ª–µ–Ω–æ");
			break;
		case "start":
			$this->sendToAll("[SG] –ò–≥—Ä–∞ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Ä–∞–Ω—å—à–µ...");
			$this->gameStatus=1;
			$this->lastTime=5;
			break;
		case "reload":
			unset($this->config);
			@mkdir($this->getDataFolder(), 0777, true);
			$this->config=new Config($this->getDataFolder() . "config.yml", Config::YAML, array());
			if($this->config->exists("lastpos"))
			{
				$this->sign=$this->config->get("sign");
				$this->pos1=$this->config->get("pos1");
				$this->pos2=$this->config->get("pos2");
				$this->pos3=$this->config->get("pos3");
				$this->pos4=$this->config->get("pos4");
				$this->pos5=$this->config->get("pos5");
				$this->pos6=$this->config->get("pos6");
				$this->pos7=$this->config->get("pos7");
				$this->pos8=$this->config->get("pos8");
				$this->lastpos=$this->config->get("lastpos");
				$this->level=$this->getServer()->getLevelByName($this->config->get("pos1")["level"]);
				$this->signlevel=$this->getServer()->getLevelByName($this->config->get("sign")["level"]);
				$this->sign=new Vector3($this->sign["x"],$this->sign["y"],$this->sign["z"]);
				$this->pos1=new Vector3($this->pos1["x"]+0.5,$this->pos1["y"],$this->pos1["z"]+0.5);
				$this->pos2=new Vector3($this->pos2["x"]+0.5,$this->pos2["y"],$this->pos2["z"]+0.5);
				$this->pos3=new Vector3($this->pos3["x"]+0.5,$this->pos3["y"],$this->pos3["z"]+0.5);
				$this->pos4=new Vector3($this->pos4["x"]+0.5,$this->pos4["y"],$this->pos4["z"]+0.5);
				$this->pos5=new Vector3($this->pos5["x"]+0.5,$this->pos5["y"],$this->pos5["z"]+0.5);
				$this->pos6=new Vector3($this->pos6["x"]+0.5,$this->pos6["y"],$this->pos6["z"]+0.5);
				$this->pos7=new Vector3($this->pos7["x"]+0.5,$this->pos7["y"],$this->pos7["z"]+0.5);
				$this->pos8=new Vector3($this->pos8["x"]+0.5,$this->pos8["y"],$this->pos8["z"]+0.5);
				$this->lastpos=new Vector3($this->lastpos["x"]+0.5,$this->lastpos["y"],$this->lastpos["z"]+0.5);
			}
			if(!$this->config->exists("endTime"))
			{
				$this->config->set("endTime",600);
			}
			if(!$this->config->exists("gameTime"))
			{
				$this->config->set("gameTime",300);
			}
			if(!$this->config->exists("waitTime"))
			{
				$this->config->set("waitTime",180);
			}
			if(!$this->config->exists("godTime"))
			{
				$this->config->set("godTime",15);
			}
			$this->endTime=(int)$this->config->get("endTime");
			$this->gameTime=(int)$this->config->get("gameTime");
			$this->waitTime=(int)$this->config->get("waitTime");
			$this->godTime=(int)$this->config->get("godTime");
			$this->gameStatus=0;
			$this->lastTime=0;
			$this->players=array();
			$this->SetStatus=array();
			$this->all=0;
			$this->config->save();
			$sender->sendMessage("[SG] –í—Å–µ —É–¥–∞–ª–µ–Ω–æ");
			break;
		default:
			return false;
			break;
		}
		return true;
	}
	
	public function onPlayerRespawn(PlayerRespawnEvent $event){
        $player = $event->getPlayer();
        $p = $event->getPlayer();
        if($this->config->exists("lastpos"))
        {
			if($player->getLevel()->getFolderName()==$this->level->getFolderName())
			{
				$v3=$this->signlevel->getSpawnLocation();
				$event->setRespawnPosition(new Position($v3->x,$v3->y,$v3->z,$this->signlevel));
			    $p->getInventory()->clearAll();
			}
		}
		unset($event,$player);
    }
	
	public function onPlace(BlockPlaceEvent $event)
	{
		if(!isset($this->sign))
		{
			return;
		}
		$block=$event->getBlock();
		if($this->PlayerIsInGame($event->getPlayer()->getName()) || $block->getLevel()==$this->level)
		{
			if(!$event->getPlayer()->isOp())
			{
				$event->setCancelled();
			}
		}
		unset($block,$event);
	}
	
	public function onMove(PlayerMoveEvent $event)
	{
		if(!isset($this->sign))
		{
			return;
		}
		if($this->PlayerIsInGame($event->getPlayer()->getName()) && $this->gameStatus<=1)
		{
			if(!$event->getPlayer()->isOp())
			{
				$event->setCancelled();
			}
		}
		unset($event);
	}
	public function onBreak(BlockBreakEvent $event)
	{
		if(!isset($this->sign))
		{
			return;
		}
		$sign=$this->config->get("sign");
		$block=$event->getBlock();
		if($this->PlayerIsInGame($event->getPlayer()->getName()) || ($block->getX()==$sign["x"] && $block->getY()==$sign["y"] && $block->getZ()==$sign["z"] && $block->getLevel()->getFolderName()==$sign["level"]) || $block->getLevel()==$this->level)
		{
			if(!$event->getPlayer()->isOp())
			{
				$event->setCancelled();
			}
		}
		unset($sign,$block,$event);
	}
	
	public function onPlayerCommand(PlayerCommandPreprocessEvent $event)
	{
		if(!$this->PlayerIsInGame($event->getPlayer()->getName()) || $event->getPlayer()->isOp() || substr($event->getMessage(),0,1)!="/")
		{
			unset($event);
			return;
		}
		switch(strtolower(explode(" ",$event->getMessage())[0]))
		{
		case "/kill":
		case "/lobby":
			
			break;
		default:
			$event->setCancelled();
			$event->getPlayer()->sendMessage("[SG] –¢—ã –Ω–∞ –∞—Ä–µ–Ω–µ, –∑–¥–µ—Å—å –≤—Å–µ –∫–æ–º–∞–Ω–¥—ã –∑–∞–ø—Ä–µ—â–µ–Ω—ã !");
			$event->getPlayer()->sendMessage("[SG] –¢—ã –º–æ–∂–µ—à—å –Ω–∞–ø–∏—Å–∞—Ç—å –∑–¥–µ—Å—å —Ç–æ–ª—å–∫–æ /lobby");
			break;
		}
		unset($event);
	}
	
	public function onDamage(EntityDamageEvent $event)
	{
		$player = $event->getEntity();
		if ($event instanceof EntityDamageByEntityEvent)
		{
        	$player = $event->getEntity();
        	$killer = $event->getDamager();
			if($player instanceof Player && $killer instanceof Player)
			{
		    	if($this->PlayerIsInGame($player->getName()) && ($this->gameStatus==2 || $this->gameStatus==1))
		    	{
		    		$event->setCancelled();
		    	}
		    	if($this->PlayerIsInGame($player->getName()) && !$this->PlayerIsInGame($killer->getName()) && !$killer->isOp())
		    	{
		    		$event->setCancelled();
		    		$killer->sendMessage("[SG] –ù–µ –ø–æ—Ä—Ç—å –ª—é–¥—è–º –∏–≥—Ä—É !");
		    		$killer->kill();
		    	}
		    }
		}
		
		unset($player,$killer,$event);
	}
	
	public function PlayerIsInGame($name)
	{

		return isset($this->players[$name]);
	}
	
	public function sendToAll($msg){
		foreach($this->players as $pl)
		{
			$this->getServer()->getPlayer($pl["id"])->sendMessage($msg);
		}
		$this->getServer()->getLogger()->info($msg);
		unset($pl,$msg);
	}
	
	public function gameTimber(){
		if(!isset($this->lastpos) || $this->lastpos==array())
		{
			return;
		}
		if(!$this->signlevel instanceof Level)
		{
			$this->level=$this->getServer()->getLevelByName($this->config->get("pos1")["level"]);
			$this->signlevel=$this->getServer()->getLevelByName($this->config->get("sign")["level"]);
			if(!$this->signlevel instanceof Level)
			{
				return;
			}
		}
		$this->changeStatusSign();
		if($this->gameStatus==0)
		{
			$i=0;
			foreach($this->players as $key=>$val)
			{
				$i++;
				$p=$this->getServer()->getPlayer($val["id"]);
				//echo($i."\n");
				$p->setLevel($this->level);
				eval("\$p->teleport(\$this->pos".$i.");");
				unset($p);
			}
		}
		if($this->gameStatus==1)
		{
			$this->lastTime--;
			$i=0;
			foreach($this->players as $key=>$val)
			{
				$i++;
				$p=$this->getServer()->getPlayer($val["id"]);
				//echo($i."\n");
				$p->setLevel($this->level);
				eval("\$p->teleport(\$this->pos".$i.");");
				unset($p);
			}
			switch($this->lastTime)
			{
			case 1:
			case 2:
			case 3:
			case 4:
			case 5:
			case 10:
			case 20:
			case 30:
			case 40:
			case 50:
				$this->sendToAll("[SG] –ò–≥—Ä–∞ –Ω–∞—á–Ω–µ—Ç—Å—è —á–µ—Ä–µ–∑ ".$this->lastTime." —Å–µ–∫.");
				break;
			case 60:
				$this->sendToAll("[SG] –ò–≥—Ä–∞ –Ω–∞—á–Ω–µ—Ç—Å—è —á–µ—Ä–µ–∑ –º–∏–Ω—É—Ç—É.");
				break;
			case 90:
				$this->sendToAll("[SG] –ò–≥—Ä–∞ –Ω–∞—á–Ω–µ—Ç—Å—è —á–µ—Ä–µ–∑ –º–∏–Ω—É—Ç—É –∏ 30 —Å–µ–∫.");
				break;
			case 120:
				$this->sendToAll("[SG] –ò–≥—Ä–∞ –Ω–∞—á–Ω–µ—Ç—Å—è —á–µ—Ä–µ–∑ 2 –º–∏–Ω—É—Ç—ã.");
				break;
			case 150:
				$this->sendToAll("[SG] –ò–≥—Ä–∞ –Ω–∞—á–Ω–µ—Ç—Å—è —á–µ—Ä–µ–∑ 2 –º–∏–Ω—É—Ç—ã –∏ 30 —Å–µ–∫.");
				break;
			case 0:
				$this->gameStatus=2;
				$this->sendToAll("[SG] –ò–≥—Ä–∞ –Ω–∞—á–∞–ª–∞—Å—å !");
				$this->sendToAll("[SG] –í—ã –Ω–µ—É—è–∑–≤–∏–º—ã 15 —Å–µ–∫ !");
				$this->lastTime=$this->godTime;
				$this->resetChest();
				foreach($this->players as $key=>$val)
				{
					$p=$this->getServer()->getPlayer($val["id"]);
					$p->setMaxHealth(40);
					$p->setHealth(40);
					$p->setLevel($this->level);
				}
				$this->all=count($this->players);
				break;
			}
		}
		if($this->gameStatus==2)
		{
			$this->lastTime--;
			if($this->lastTime<=0)
			{
				$this->gameStatus=3;
				$this->sendToAll("[SG] –ù–µ—É—è–∑–≤–∏–º–æ—Å—Ç—å –∫–æ–Ω—á–∏–ª–∞—Å—å !");
				$this->lastTime=$this->gameTime;
			}
		}
		if($this->gameStatus==3 || $this->gameStatus==4)
		{
			if(count($this->players)==1)
			{
				foreach($this->players as &$pl)
				{
					$p=$this->getServer()->getPlayer($pl["id"]);
					Server::getInstance()->broadcastMessage("[SG] –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º –∏–≥—Ä–æ–∫–∞ ".$p->getName()." —Å –ø–æ–±–µ–¥–æ–π –≤ –∏–≥—Ä–µ !");
					$p->setLevel($this->signlevel);
					$p->getInventory()->clearAll();
					$p->setMaxHealth(20);
					$p->setHealth(20);
					$p->teleport($this->signlevel->getSpawnLocation());
					unset($pl,$p);
				}
				$this->clearChest();
				$this->players=array();
				$this->gameStatus=0;
				$this->lastTime=0;
				return;
			}
			else if(count($this->players)==0)
			{
				Server::getInstance()->broadcastMessage("[SG] –ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞ , —Ç.–∫. –≤—Å–µ –∏–≥—Ä–æ–∫–∏ —É–º–µ—Ä–ª–∏ !");
				$this->gameStatus=0;
				$this->lastTime=0;
				$this->clearChest();
				$this->ClearAllInv();
				return;
			}
		}
		if($this->gameStatus==3)
		{
			$this->lastTime--;
			switch($this->lastTime)
			{
			case 1:
			case 2:
			case 3:
			case 4:
			case 5:
			case 10:
				$this->sendToAll("[SG] –î–æ –°–º–µ—Ä—Ç–µ–ª—å–Ω–æ–≥–æ –ë–æ—è ".$this->lastTime." —Å–µ–∫.");
				break;
			case 100:
				$this->clearChest();
 				$this->resetChest();
				$this->sendToAll("[SG] –í—Å–µ –°—É–Ω–¥—É–∫–∏ –ó–∞–ø–æ–ª–Ω–µ–Ω—ã!");
				break;
			case 101:
				$this->sendToAll("[SG] –î–æ –ó–∞–ø–æ–ª–Ω–µ–Ω–∏—è –°—É–Ω–¥—É–∫–æ–≤ 1 —Å–µ–∫—É–Ω–¥–∞!");
				break;
			case 102:
				$this->sendToAll("[SG] –î–æ –ó–∞–ø–æ–ª–Ω–µ–Ω–∏—è –°—É–Ω–¥—É–∫–æ–≤ 2 —Å–µ–∫—É–Ω–¥—ã!");
				break;
			case 103:
				$this->sendToAll("[SG] –î–æ –ó–∞–ø–æ–ª–Ω–µ–Ω–∏—è –°—É–Ω–¥—É–∫–æ–≤ 3 —Å–µ–∫—É–Ω–¥—ã!");
				break;
			case 104:
				$this->sendToAll("[SG] –î–æ –ó–∞–ø–æ–ª–Ω–µ–Ω–∏—è –°—É–Ω–¥—É–∫–æ–≤ 4 —Å–µ–∫—É–Ω–¥—ã!");
				break;
			case 105:
				$this->sendToAll("[SG] –î–æ –ó–∞–ø–æ–ª–Ω–µ–Ω–∏—è –°—É–Ω–¥—É–∫–æ–≤ 5 —Å–µ–∫—É–Ω–¥!");
				break;
			case 110:
				$this->sendToAll("[SG] –î–æ –ó–∞–ø–æ–ª–Ω–µ–Ω–∏—è –°—É–Ω–¥—É–∫–æ–≤ 10 —Å–µ–∫!");
				break;
			case 120:
				$this->sendToAll("[SG] –î–æ –ó–∞–ø–æ–ª–Ω–µ–Ω–∏—è –°—É–Ω–¥—É–∫–æ–≤ 20 —Å–µ–∫!");
				break;
			case 130:
				$this->sendToAll("[SG] –î–æ –ó–∞–ø–æ–ª–Ω–µ–Ω–∏—è –°—É–Ω–¥—É–∫–æ–≤ 30 —Å–µ–∫!");
				break;
			case 0:
				$this->sendToAll("[SG] –°–º–µ—Ä—Ç–µ–ª—å–Ω—ã–π –ë–æ–π –Ω–∞—á–∞–ª—Å—è !");
				foreach($this->players as $pl)
				{
					$p=$this->getServer()->getPlayer($pl["id"]);
					$p->setLevel($this->level);
					$p->teleport($this->lastpos);
					unset($p,$pl);
				}
				$this->gameStatus=4;
				$this->lastTime=$this->endTime;
				break;
			}
		}
		if($this->gameStatus==4)
		{
			$this->lastTime--;
			switch($this->lastTime)
			{
			case 1:
			case 2:
			case 3:
			case 4:
			case 5:
			case 10:
			case 20:
			case 30:
				$this->sendToAll("[SG] –î–æ –∫–æ–Ω—Ü–∞ –∏–≥—Ä—ã ".$this->lastTime." —Å–µ–∫.");
				break;
			case 0:
				Server::getInstance()->broadcastMessage("[SG] –í—Ä–µ–º—è –≤—ã—à–ª–æ, –∏–≥—Ä–∞ –∑–∞–∫–æ–Ω—á–∏–ª–∞—Å—å !");
				foreach($this->players as $pl)
				{
					$p=$this->getServer()->getPlayer($pl["id"]);
					$p->setLevel($this->signlevel);
					$p->teleport($this->signlevel->getSpawnLocation());
					$p->getInventory()->clearAll();
					$p->setMaxHealth(20);
					$p->setHealth(20);
					unset($p,$pl);
				}
				$this->clearChest();
				//$this->ClearAllInv();
				$this->players=array();
				$this->gameStatus=0;
				$this->lastTime=0;
				break;
			}
		}
		$this->changeStatusSign();
	}
	
	public function getMoney($name){
		return EconomyAPI::getInstance()->myMoney($name);
	}
	
	public function addMoney($name,$money){
		EconomyAPI::getInstance()->addMoney($name,$money);
		unset($name,$money);
	}
	
	public function setMoney($name,$money){
		EconomyAPI::getInstance()->setMoney($name,$money);
		unset($name,$money);
	}
	
	public function resetChest()
	{
		FineChests::getInstance()->ResetChest();
	}
	
	public function clearChest()
	{
		FineChests::getInstance()->ClearChest();
	}
	public function PlayerDeath(PlayerDeathEvent $event){
		if($this->gameStatus==3 || $this->gameStatus==4)
		{
			if(isset($this->players[$event->getEntity()->getName()]))
			{
				$this->ClearInv($event->getEntity());
				unset($this->players[$event->getEntity()->getName()]);
				if(count($this->players)>1)
				{
					$this->sendToAll("¬ßl¬ße[SG] –ò–≥—Ä–æ–∫ {$event->getEntity()->getName()} —É–º–µ—Ä!");
					$this->sendToAll("¬ßl¬ße[SG] –û—Å—Ç–∞–ª–æ—Å—å –ò–≥—Ä–æ–∫–æ–≤:".count($this->players));
					$this->sendToAll("¬ßl¬ße[SG] –û—Å—Ç–∞–ª–æ—Å—å –í—Ä–µ–º–µ–Ω–∏:".$this->lastTime." —Å–µ–∫.");
				}
				$this->changeStatusSign();
			}
			
		}
	}
 	
	public function changeStatusSign()
	{
		if(!isset($this->sign))
		{
			return;
		}
		$sign=$this->signlevel->getTile($this->sign);
		if($sign instanceof Sign)
		{
			switch($this->gameStatus)
			{
			case 0:
				$sign->setText("¬ßl¬ße„Ää[SG]„Äã","¬ßl¬ßa–ñ–º—è–∫–Ω–∏!","¬ßl¬ßa–ò–≥—Ä–æ–∫–æ–≤:".count($this->players),"");
				break;
			case 1:
				$sign->setText("¬ßl¬ße„Ää[SG]„Äã","¬ßl¬ßa–ñ–º—è–∫–Ω–∏!","¬ßl¬ßa–ò–≥—Ä–æ–∫–æ–≤:".count($this->players),"¬ßl¬ßb–í—Ä–µ–º–µ–Ω–∏:".$this->lastTime."—Å–µ–∫.");
				break;
			case 2:
				$sign->setText("¬ßl¬ße„Ää[SG]„Äã","¬ßl¬ßd–°–∫–æ—Ä–æ –ù–∞—á–∞–ª–æ","¬ßl¬ßa–ò–≥—Ä–æ–∫–æ–≤:".count($this->players),"¬ßl¬ßb–í—Ä–µ–º–µ–Ω–∏:".$this->lastTime."—Å–µ–∫.");
				break;
			case 3:
				$sign->setText("¬ßl¬ße„Ää[SG]„Äã","¬ßl¬ßf–ò–¥–µ—Ç –ò–≥—Ä–∞","¬ßl¬ßa–ò–≥—Ä–æ–∫–æ–≤:".count($this->players)."/{$this->all}","¬ßl¬ßb–í—Ä–µ–º–µ–Ω–∏:".$this->lastTime."—Å–µ–∫.");
				break;
			case 4:
				$sign->setText("¬ßl¬ße„Ää[SG]„Äã","¬ßl¬ßc–°–ë","¬ßl¬ßa–ò–≥—Ä–æ–∫–æ–≤ :".count($this->players)."/{$this->all}","¬ßl¬ßb–í—Ä–µ–º–µ–Ω–∏ :".$this->lastTime."—Å–µ–∫.");
				break;
			}
		}
		unset($sign);
	}
	public function playerBlockTouch(PlayerInteractEvent $event){
		$player=$event->getPlayer();
		$username=$player->getName();
		$block=$event->getBlock();
		$levelname=$player->getLevel()->getFolderName();
		if(isset($this->SetStatus[$username]))
		{
			switch ($this->SetStatus[$username])
			{
			case 0:

				if($event->getBlock()->getID() != 63 && $event->getBlock()->getID() != 68)
				{
					$player->sendMessage(TextFormat::GREEN."[SG] –¢—ã–∫–Ω–∏ —Å–∏–≥–Ω—É");
					return;
				}
				$this->sign=array(
					"x" =>$block->getX(),
					"y" =>$block->getY(),
					"z" =>$block->getZ(),
					"level" =>$levelname);
				$this->config->set("sign",$this->sign);
				$this->config->save();
				$this->SetStatus[$username]++;
				$player->sendMessage(TextFormat::GREEN."[SG] –°–∏–≥–Ω–∞ –∑–∞–ø–∏—Å–∞–Ω–∞");
				$player->sendMessage(TextFormat::GREEN."[SG] –¢—ã–∫–Ω–∏ 1 —Å–ø–∞–≤–Ω");
				$this->signlevel=$this->getServer()->getLevelByName($this->config->get("sign")["level"]);
				$this->sign=new Vector3($this->sign["x"],$this->sign["y"],$this->sign["z"]);

				$this->changeStatusSign();
				break;
			case 1:
				$this->pos1=array(
					"x" =>$block->x,
					"y" =>$block->y,
					"z" =>$block->z,
					"level" =>$levelname);
				$this->config->set("pos1",$this->pos1);
				$this->config->save();
				$this->SetStatus[$username]++;
				$player->sendMessage(TextFormat::GREEN."[SG] 1 —Å–ø–∞–≤–Ω –∑–∞–ø–∏—Å–∞–Ω");
				$player->sendMessage(TextFormat::GREEN."[SG] –¢—ã–∫–Ω–∏ 2-–æ–π");
				$this->pos1=new Vector3($this->pos1["x"]+0.5,$this->pos1["y"],$this->pos1["z"]+0.5);
				break;
			case 2:
				 $this->pos2=array(
					"x" =>$block->x,
					"y" =>$block->y,
					"z" =>$block->z,
					"level" =>$levelname);
				$this->config->set("pos2",$this->pos2);
				$this->config->save();
				$this->SetStatus[$username]++;
				$player->sendMessage(TextFormat::GREEN."[SG] 2-–æ–π –∑–∞–ø–∏—Å–∞–Ω");
				$player->sendMessage(TextFormat::GREEN."[SG] –¢—ã–∫–Ω–∏ 3-–∏–π");
				$this->pos2=new Vector3($this->pos2["x"]+0.5,$this->pos2["y"],$this->pos2["z"]+0.5);
				break;	
			case 3:
				$this->pos3=array(
					"x" =>$block->x,
					"y" =>$block->y,
					"z" =>$block->z,
					"level" =>$levelname);
				$this->config->set("pos3",$this->pos3);
				$this->config->save();
				$this->SetStatus[$username]++;
				$player->sendMessage(TextFormat::GREEN."[SG] 3-–∏–π –∑–∞–ø–∏—Å–∞–Ω");
				$player->sendMessage(TextFormat::GREEN."[SG] –¢—ã–∫–Ω–∏ 4-—ã–π");
				$this->pos3=new Vector3($this->pos3["x"]+0.5,$this->pos3["y"],$this->pos3["z"]+0.5);
				break;	
			case 4:
				$this->pos4=array(
					"x" =>$block->x,
					"y" =>$block->y,
					"z" =>$block->z,
					"level" =>$levelname);
				$this->config->set("pos4",$this->pos4);
				$this->config->save();
				$this->SetStatus[$username]++;
				$player->sendMessage(TextFormat::GREEN."[SG] 4-—ã–π –∑–∞–ø–∏—Å–∞–Ω");
				$player->sendMessage(TextFormat::GREEN."[SG] –¢—ã–∫–Ω–∏ 5-—ã–π");
				$this->pos4=new Vector3($this->pos4["x"]+0.5,$this->pos4["y"],$this->pos4["z"]+0.5);
				break;
			case 5:
				$this->pos5=array(
					"x" =>$block->x,
					"y" =>$block->y,
					"z" =>$block->z,
					"level" =>$levelname);
				$this->config->set("pos5",$this->pos5);
				$this->config->save();
				$this->SetStatus[$username]++;
				$player->sendMessage(TextFormat::GREEN."[SG] 5-—ã–π –∑–∞–ø–∏—Å–∞–Ω");
				$player->sendMessage(TextFormat::GREEN."[SG] –¢—ã–∫–Ω–∏ 6-–æ–π");
				$this->pos5=new Vector3($this->pos5["x"]+0.5,$this->pos5["y"],$this->pos5["z"]+0.5);
				break;
			case 6:
				$this->pos6=array(
					"x" =>$block->x,
					"y" =>$block->y,
					"z" =>$block->z,
					"level" =>$levelname);
				$this->config->set("pos6",$this->pos6);
				$this->config->save();
				$this->SetStatus[$username]++;
				$player->sendMessage(TextFormat::GREEN."[SG] 6-–æ–π –∑–∞–ø–∏—Å–∞–Ω");
				$player->sendMessage(TextFormat::GREEN."[SG] –¢—ã–∫–Ω–∏ 7-–æ–π");
				$this->pos6=new Vector3($this->pos6["x"]+0.5,$this->pos6["y"],$this->pos6["z"]+0.5);
				break;
			case 7:
				$this->pos7=array(
					"x" =>$block->x,
					"y" =>$block->y,
					"z" =>$block->z,
					"level" =>$levelname);
				$this->config->set("pos7",$this->pos7);
				$this->config->save();
				$this->SetStatus[$username]++;
				$player->sendMessage(TextFormat::GREEN."[SG] 7-–æ–π –∑–∞–ø–∏—Å–∞–Ω");
				$player->sendMessage(TextFormat::GREEN."[SG] –¢—ã–∫–Ω–∏ 8-–æ–π");
 
				$this->pos7=new Vector3($this->pos7["x"]+0.5,$this->pos7["y"],$this->pos7["z"]+0.5);
				break;	
			case 8:
				$this->pos8=array(
					"x" =>$block->x,
					"y" =>$block->y,
					"z" =>$block->z,
					"level" =>$levelname);
				$this->config->set("pos8",$this->pos8);
				$this->config->save();
				$this->SetStatus[$username]++;
				$player->sendMessage(TextFormat::GREEN."[SG] 8-–æ–π –∑–∞–ø–∏—Å–∞–Ω");
				$player->sendMessage(TextFormat::GREEN."[SG] –¢—ã–∫–Ω–∏ —Å–ø–∞–≤–Ω –°–ë");
				$this->pos8=new Vector3($this->pos8["x"]+0.5,$this->pos8["y"],$this->pos8["z"]+0.5);
				break;
			case 9:
				$this->lastpos=array(
					"x" =>$block->x,
					"y" =>$block->y,
					"z" =>$block->z,
					"level" =>$levelname);
				$this->config->set("lastpos",$this->lastpos);
				$this->config->save();
				$this->lastpos=new Vector3($this->lastpos["x"]+0.5,$this->lastpos["y"],$this->lastpos["z"]+0.5);
				unset($this->SetStatus[$username]);
				$player->sendMessage(TextFormat::GREEN."[SG] –°–ø–∞–≤–Ω –°–ë –≥–æ—Ç–æ–≤");
				$player->sendMessage(TextFormat::GREEN."[SG] –¢—ã —É–∂–µ –º–æ–∂–µ—à –∏–≥—Ä–∞—Ç—å!");
				$this->level=$this->getServer()->getLevelByName($this->config->get("pos1")["level"]);					
			}
		}
		else
		{
			$sign=$event->getPlayer()->getLevel()->getTile($event->getBlock());
			if(isset($this->lastpos) && $this->lastpos!=array() && $sign instanceof Sign && $sign->getX()==$this->sign->x && $sign->getY()==$this->sign->y && $sign->getZ()==$this->sign->z && $event->getPlayer()->getLevel()->getFolderName()==$this->config->get("sign")["level"])
			{
				if(!$this->config->exists("lastpos"))
				{
					$event->getPlayer()->sendMessage("[SG] –¢—ã –Ω–µ –º–æ–∂–µ—à—å –∑–∞–π—Ç–∏, —Å–ø–∞–≤–Ω –°–ë –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω");
					return;
				}
				if(!$event->getPlayer()->hasPermission("FSurvivalGame.touch.startgame"))
				{
					$event->getPlayer()->sendMessage("[SG] –£ —Ç–µ–±—è –Ω–µ—Ç —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –∑–∞—Ö–æ–¥–∏—Ç—å –Ω–∞ –∞—Ä–µ–Ω—É");
					return;
				}
				if(!$event->getPlayer()->isOp())
				{
					$inv=$event->getPlayer()->getInventory();
					for($i=0;$i<$inv->getSize();$i++)
    				{
    					if($inv->getItem($i)->getID()!=0)
    					{
    						$event->getPlayer()->sendMessage("[SG] –ü–µ—Ä–µ–¥ –∏–≥—Ä–æ–π –≤—ã–∫–∏–Ω—å –≤—Å–µ —Å–≤–æ–∏ –≤–µ—â–∏ !");
    						return;
    					}
    				}
    				foreach($inv->getArmorContents() as $i)
    				{
    					if($i->getID()!=0)
    					{
    						$event->getPlayer()->sendMessage("[SG] –ü–µ—Ä–µ–¥ –∏–≥—Ä–æ–π –≤—ã–∫–∏–Ω—å –≤—Å—é —Å–≤–æ—é —ç–∫–∏–ø–∏—Ä–æ–≤–∫—É !");
    						return;
    					}
    				}
    			}
				if($this->gameStatus==0 || $this->gameStatus==1)
				{
					if(!isset($this->players[$event->getPlayer()->getName()]))
					{
						if(count($this->players)>=8)
						{
							$event->getPlayer()->sendMessage("[SG] –ê—Ä–µ–Ω–∞ –ø–æ–ª–Ω–∞—è, –∂–¥–∏—Ç–µ –æ–∫–æ–Ω—á–∞–Ω–∏—è –∏–≥—Ä—ã !");
							return;
						}
						$this->sendToAll("[SG] ".$event->getPlayer()->getName()." –∑–∞—à–µ–ª –Ω–∞ –∞—Ä–µ–Ω—É.");
						$this->players[$event->getPlayer()->getName()]=array("id"=>$event->getPlayer()->getName());
						$event->getPlayer()->sendMessage("[SG] –í—ã –ø—Ä–∏—Å–æ–µ–¥–µ–Ω–∏–ª–∏—Å—å –∫ –∏–≥—Ä–µ");
						if($this->gameStatus==0 && count($this->players)>=2)
						{
							$this->gameStatus=1;
							$this->lastTime=$this->waitTime;
							$this->sendToAll("[SG] –û—Ç—Å—á–µ—Ç –Ω–∞—á–∞–ª—Å—è!");
						}
						if(count($this->players)==8 && $this->gameStatus==1 && $this->lastTime>5)
						{
							$this->sendToAll("[SG] –ê—Ä–µ–Ω–∞ –ø–æ–ª–Ω–∞—è, –Ω–∞—á–Ω–∏–Ω–∞–µ–º —Ä–∞–Ω—å—à–µ!");
							$this->lastTime=5;
						}
						$this->changeStatusSign();
					}
					else
					{
						$event->getPlayer()->sendMessage("[SG] –ï—Å–ª–∏ —Ç—ã —Ö–æ—á–µ—à—å –ø–æ–∫–∏–Ω—É—Ç—å –∞—Ä–µ–Ω—É - –≤–≤–µ–¥–∏ /lobby");
					}
				}
				else
				{
					$event->getPlayer()->sendMessage("[SG] –í—ã –Ω–µ –º–æ–∂–µ—Ç–µ –≤–æ–π—Ç–∏, —Ç.–∫. –∏–≥—Ä–∞ —É–∂–µ –∏–¥–µ—Ç!");
				}
			}
		}
	}
	
	public function ClearInv($player)
	{
		if(!$player instanceof Player)
		{
			unset($player);
			return;
		}
		$inv=$player->getInventory();
		if(!$inv instanceof Inventory)
		{
			unset($player,$inv);
			return;
		}
		$inv->clearAll();
		unset($player,$inv);
	}
	
	public function ClearAllInv()
	{
		foreach($this->players as $pl)
		{
			$player=$this->getServer()->getPlayer($pl["id"]);
			if(!$player instanceof Player)
			{
				continue;
			}
			$this->ClearInv($player);
		}
		unset($pl,$player);
	}
	
	public function PlayerQuit(PlayerQuitEvent $event){
		if(isset($this->players[$event->getPlayer()->getName()]))
		{	
			unset($this->players[$event->getPlayer()->getName()]);
			$this->ClearInv($event->getPlayer());
			$this->sendToAll("[SG] ".$event->getPlayer()->getName()." –ø–æ–∫–∏–Ω—É–ª –∞—Ä–µ–Ω—É.");
			$this->changeStatusSign();
			if($this->gameStatus==1 && count($this->players)<2)
			{
				$this->gameStatus=0;
				$this->lastTime=0;
				$this->sendToAll("[SG] –ù–∞ –∞—Ä–µ–Ω–µ 1 –∏–≥—Ä–æ–∫, –æ—Ç—Å—á–µ—Ç –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω!");
				/*foreach($this->players as $pl)
				{
					$p=$this->getServer()->getPlayer($pl["id"]);
					$p->setLevel($this->signlevel);
					$p->teleport($this->signlevel->getSpawnLocation());
					unset($p,$pl);
				}*/
			}
		}
	}
	
	public function onDisable(){
		$this->getServer()->getLogger()->info(TextFormat::RED."[Finecraft_SG] –í—ã–∫–ª—é—á–µ–Ω–æ !");
	}
}
?>
name: Finecraft_SG
main: Asidert\Finecraft_SG
version: "0.5"
api: [1.0.0]
load: POSTWORLD
author: Asidert
commands:
 fsg:
  permission: FSurvivalGame.command.fsg
  description: –ì–ª–∞–≤–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞
  usage: /fsg <set|remove>
 lobby:
  permission: FSurvivalGame.command.lobby
  description: –í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –ª–æ–±–±–∏
  usage: /lobby
permissions:
 FSurvivalGame.*:
  description: –ì–ª–∞–≤–Ω–∞—è
  default: op
  children:
   FSurvivalGame.command.*:
    description: –Æ–∑
    default: op
    children:
     FSurvivalGame.command.lobby:
      description: –í –ª–æ–±–±–∏
      default: true
     FSurvivalGame.command.fsg:
      description: –£—Å—Ç–∞–Ω–æ–≤–∫–∞
      default: op
   FSurvivalGame.touch.startgame:
    description: –ó–∞–π—Ç–∏ –≤ –∏–≥—Ä—É
    default: true
√É≥
 –s°MÜ6˚?#∞ës   GBMB